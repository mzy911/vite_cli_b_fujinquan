# vite 的预加载

```js
// lodash可能也import了其他的东西
import _ from "lodash";
```



```js
// lodash可能也import了其他的东西
import _ from "/node_modules/.vite/lodash";

import __vite__cjsImport0_lodash from "/node_modules/.vite/deps/lodash.js?v=ebe57916";
```



##### vite 查找资源的原理
* 非绝对路径或者相对路径开启`路径补全`
* 并非自下而上、浪费性能
* 开发：每次依赖预构建所重新构建的相对路径都是正确的
* 生产：交给 rollup 的库去完成生产环境的打包



##### 依赖预构建
* 首先 vite 会找到对应的依赖
* 调用 esbuild(语法库)，将其他规范的代码转换成 esmodule 规范
* 然后放到当前目录下的 node_modules/.vite/deps
* 同时对 esmodule 规范的各个模块进行统一集成



#####  解决了 3 个问题:

* 不同的第三方包会有不同的导出格式(vite 本身没法约束人家)
* 对路径的处理上可以直接使用 .vite/deps 方便路径重写
* 叫做网络多包传输的性能问题(也是原生 esmodule 规范不敢支持 node_modules 的原因之一), 有了依赖预构建以后无论他有多少的额外 export 和 import, vite 都会尽可能的将他们进行集成最后只生成一个或者几个模块

vite.config.js === webpack.config.hs
